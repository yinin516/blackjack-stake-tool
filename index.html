<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Stake Blackjack 全功能輔助工具</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background-color: #0f172a;
      font-family: 'Segoe UI', sans-serif;
      color: #e2e8f0;
      padding: 20px;
    }
    h1, h2 {
      color: #facc15;
    }
    .section, .stat-card, .chart-container {
      background-color: #1e293b;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.4);
    }
    label, select, input, button {
      font-size: 16px;
      margin: 6px;
    }
    select, input {
      background-color: #334155;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 8px;
    }
    button {
      background: #22c55e;
      color: black;
      font-weight: bold;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
    }
    .danger {
      background: #ef4444;
      color: white;
    }
    .result, .stat-card p {
      font-size: 18px;
      margin-top: 10px;
    }
    .win { color: #4ade80; }
    .loss { color: #f87171; }
    .profit { color: #facc15; }
  </style>
</head>
<body>
  <h1>Stake 真人 21點 輔助工具</h1>

  <div class="section">
    <h2>🎮 模式切換</h2>
    <label>模式：</label>
    <select id="modeSelect">
      <option value="live">真人 21 點</option>
      <option value="stake">Stake 原創</option>
    </select>
  </div>

  <div class="section">
    <h2>🎴 基本策略建議</h2>
    <label>你的牌：</label>
    <select id="card1"></select>
    <select id="card2"></select>
    <select id="card3"><option value="">-</option></select>
    <select id="card4"><option value="">-</option></select>
    <select id="card5"><option value="">-</option></select>

    <label>莊家明牌：</label>
    <select id="dealerCard"></select>
    <button onclick="getStrategy()">取得建議</button>
    <button class="danger" onclick="clearCards()">清空</button>
    <div class="result" id="strategyResult">建議會顯示在這裡</div>
  </div>

  <div class="section">
    <h2>📊 注碼建議</h2>
    <label>本金：</label><input type="number" id="bankroll" value="1000">
    <label>第一注：</label><input type="number" id="baseBet" value="50">
    <label>策略：</label>
    <select id="bettingStrategy">
      <option value="flat">固定注</option>
      <option value="martingale">馬丁</option>
      <option value="fibonacci">費波那契</option>
      <option value="anti-martingale">反馬丁</option>
    </select>
    <button onclick="getNextBet()">下一注建議</button>
    <div class="result" id="betResult">建議注碼會顯示在這裡</div>
  </div>

  <div class="section">
    <h2>🧠 算牌器（Hi-Lo）</h2>
    <label>選擇牌：</label>
    <select id="countCard"></select>
    <button onclick="addToCount()">加入</button>
    <button class="danger" onclick="resetCount()">重置</button>
    <div class="result" id="countResult">目前計數：0</div>
    <div class="result" id="countAdvice"></div>
  </div>

  <div class="stat-card">
    <p>總下注金額：<span id="totalBet">0</span></p>
    <p>目前利潤：<span id="profit" class="profit">0</span></p>
    <p>勝：<span id="wins" class="win">0</span> ｜ 輸：<span id="losses" class="loss">0</span> ｜ 和：<span id="draws">0</span> ｜ 爆牌：<span id="busts">0</span></p>
  </div>

  <div class="chart-container">
    <canvas id="profitChart" height="150"></canvas>
  </div>

  <script>
   // 建牌面選單
const allRanks = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
const cardSelectors = ["card1", "card2", "card3", "card4", "card5", "dealerCard", "countCard"];
cardSelectors.forEach(id => {
  const el = document.getElementById(id);
  allRanks.forEach(r => {
    const opt = document.createElement("option");
    opt.value = r;
    opt.text = r;
    el.appendChild(opt);
  });
});

// 清空牌面
function clearCards() {
  ["card1", "card2", "card3", "card4", "card5", "dealerCard"].forEach(id => {
    document.getElementById(id).value = "";
  });
  document.getElementById("strategyResult").innerText = "建議會顯示在這裡";
}

// 牌面轉數值
function getCardValue(c) {
  if (c === "A") return 11;
  if (["K", "Q", "J"].includes(c)) return 10;
  return parseInt(c);
}

// 基本策略建議（簡化版）
function getStrategy() {
  const c1 = document.getElementById("card1").value;
  const c2 = document.getElementById("card2").value;
  const dealer = document.getElementById("dealerCard").value;
  if (!c1 || !c2 || !dealer) return;

  const total = getCardValue(c1) + getCardValue(c2);
  let advice = "";

  if (total >= 17) advice = "停牌";
  else if (total >= 13 && ["2", "3", "4", "5", "6"].includes(dealer)) advice = "停牌";
  else if (total === 11) advice = "加倍";
  else if (total === 10 && getCardValue(dealer) < 10) advice = "加倍";
  else if (total === 9 && ["3", "4", "5", "6"].includes(dealer)) advice = "加倍";
  else advice = "叫牌";

  document.getElementById("strategyResult").innerText = "建議：" + advice;
}

// 注碼建議邏輯
let betHistory = [];
function getNextBet() {
  const bankroll = parseFloat(document.getElementById("bankroll").value);
  const base = parseFloat(document.getElementById("baseBet").value);
  const strat = document.getElementById("bettingStrategy").value;

  let next = base;
  if (strat === "martingale" && betHistory.length > 0 && betHistory[betHistory.length-1].result === "lose") {
    next = betHistory[betHistory.length-1].bet * 2;
  } else if (strat === "fibonacci") {
    const fib = [base, base];
    for (let i = 2; i < 20; i++) fib[i] = fib[i-1] + fib[i-2];
    let loseCount = betHistory.filter(b => b.result === "lose").length;
    next = fib[Math.min(loseCount, 19)];
  } else if (strat === "anti-martingale" && betHistory.length > 0 && betHistory[betHistory.length-1].result === "win") {
    next = betHistory[betHistory.length-1].bet * 2;
  }

  document.getElementById("betResult").innerText = "推薦下注：" + next.toFixed(2);
}

// 算牌器
let count = 0;
function addToCount() {
  const card = document.getElementById("countCard").value;
  if (!card) return;
  if (["2", "3", "4", "5", "6"].includes(card)) count++;
  else if (["10", "J", "Q", "K", "A"].includes(card)) count--;
  document.getElementById("countResult").innerText = "目前計數：" + count;
  let advice = "下注中等";
  if (count >= 3) advice = "大注！有優勢";
  if (count <= -2) advice = "保守下注";
  document.getElementById("countAdvice").innerText = advice;
}
function resetCount() {
  count = 0;
  document.getElementById("countResult").innerText = "目前計數：0";
  document.getElementById("countAdvice").innerText = "";
}

// 統計資料與圖表更新
let stats = {
  totalBet: 0, profit: 0, wins: 0, losses: 0, draws: 0, busts: 0, history: []
};
const totalBetEl = document.getElementById("totalBet");
const profitEl = document.getElementById("profit");
const winsEl = document.getElementById("wins");
const lossesEl = document.getElementById("losses");
const drawsEl = document.getElementById("draws");
const bustsEl = document.getElementById("busts");

const ctx = document.getElementById("profitChart").getContext("2d");
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: [],
    datasets: [{
      label: '利潤走勢',
      data: [],
      borderColor: '#f87171',
      backgroundColor: 'rgba(248,113,113,0.2)',
      tension: 0.3,
      fill: true
    }]
  },
  options: {
    responsive: true,
    scales: {
      y: { ticks: { color: '#e2e8f0' }},
      x: { ticks: { color: '#e2e8f0' }}
    },
    plugins: {
      legend: {
        labels: { color: '#e2e8f0' }
      }
    }
  }
});

// 模擬結果紀錄：你可以呼叫 updateStats(bet, result)
function updateStats(bet, result) {
  stats.totalBet += bet;
  let delta = 0;
  if (result === "win") { stats.wins++; delta = bet; }
  else if (result === "lose") { stats.losses++; delta = -bet; }
  else if (result === "draw") stats.draws++;
  else if (result === "bust") { stats.busts++; delta = -bet; }

  stats.profit += delta;
  stats.history.push(stats.profit);

  totalBetEl.innerText = stats.totalBet.toFixed(2);
  profitEl.innerText = stats.profit.toFixed(2);
  winsEl.innerText = stats.wins;
  lossesEl.innerText = stats.losses;
  drawsEl.innerText = stats.draws;
  bustsEl.innerText = stats.busts;

  chart.data.labels.push("局 " + stats.history.length);
  chart.data.datasets[0].data = stats.history;
  chart.update();
}
  </script>
</body>
</html>
