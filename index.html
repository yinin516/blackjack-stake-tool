<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>Stake 真人21點 輔助工具</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background-color: #0f172a; font-family: 'Segoe UI', sans-serif; color: #e2e8f0; padding: 20px; }
    h1, h2 { color: #facc15; }
    .section, .stat-card, .chart-container {
      background-color: #1e293b; border-radius: 12px; padding: 20px; margin-bottom: 20px;
    }
    select, input, button { font-size: 16px; margin: 6px; border-radius: 8px; padding: 8px 10px; }
    select, input { background-color: #334155; color: white; border: none; }
    button { background: #22c55e; color: black; font-weight: bold; cursor: pointer; }
    .danger { background: #ef4444; color: white; }
    .result { margin-top: 10px; font-size: 18px; }
  </style>
</head>
<body>
  <h1>Stake 真人21點 輔助工具</h1>

  <div class="section">
    <h2>基本策略建議 + 分牌</h2>
    <label>你的牌：</label>
    <select id="card1"></select>
    <select id="card2"></select>
    <select id="card3"><option value="">-</option></select>
    <select id="card4"><option value="">-</option></select>
    <select id="card5"><option value="">-</option></select>
    <label>莊家明牌：</label>
    <select id="dealerCard"></select>
    <button onclick="getStrategy()">取得建議</button>
    <button class="danger" onclick="clearCards()">清空</button>
    <div class="result" id="strategyResult">建議會顯示在這裡</div>
  </div>

  <script>
    const allRanks = ["A","2","3","4","5","6","7","8","9","10","J","Q","K"];
    ["card1","card2","card3","card4","card5","dealerCard"].forEach(id => {
      const sel = document.getElementById(id);
      allRanks.forEach(card => {
        const opt = document.createElement("option");
        opt.value = card;
        opt.text = card;
        sel.appendChild(opt);
      });
    });

    function getCardValue(c) {
      if (!c) return 0;
      if (["K","Q","J"].includes(c)) return 10;
      if (c === "A") return 11;
      return parseInt(c);
    }

    function isSoftHand(cards) {
      let aceCount = cards.filter(c => c === "A").length;
      let total = cards.map(getCardValue).reduce((a,b)=>a+b,0);
      while (total > 21 && aceCount > 0) {
        total -= 10; aceCount--;
      }
      return cards.includes("A") && total <= 21 && aceCount > 0;
    }

    function getStrategy() {
      const cards = [1,2,3,4,5].map(i => document.getElementById("card"+i).value).filter(Boolean);
      const dealer = document.getElementById("dealerCard").value;
      if (cards.length < 2 || !dealer) return;

      const total = cards.map(getCardValue).reduce((a,b)=>a+b,0);
      const dealerVal = getCardValue(dealer);
      const soft = isSoftHand(cards);

      let advice = "";

      if (cards.length === 2 && cards[0] === cards[1]) {
        const pair = cards[0];
        if (["A","8"].includes(pair)) advice = "✌️ 分牌";
        else if (pair === "9" && ![7,10,11].includes(dealerVal)) advice = "✌️ 分牌";
        else if (pair === "7" && dealerVal <= 7) advice = "✌️ 分牌";
        else if (pair === "6" && dealerVal <= 6) advice = "✌️ 分牌";
        else if (pair === "4" && dealerVal >= 5 && dealerVal <= 6) advice = "✌️ 分牌";
        else if (["2","3"].includes(pair) && dealerVal <= 7) advice = "✌️ 分牌";
      }

      if (!advice) {
        if (soft) {
          if (total <= 17) advice = "